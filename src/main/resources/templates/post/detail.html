<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시물 상세</title>
</head>
<body>
<h1 th:text="${post.title}">제목</h1>
<p>작성자: <span th:text="${post.user.nickname}"></span></p>
<p>작성일: <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
<p>내용:</p>
<p th:text="${post.content}"></p>

<!-- 태그 -->
<b>태그:</b>
<span th:if="${#lists.isEmpty(post.tags)}">없음</span>

<span th:each="t : ${post.tags}" style="margin-right:6px;">
  <span th:if="${t != null}">
    <!-- 태그 -->
    <a th:href="@{|/posts/tags/${t.name}|}"
       th:text="${'#' + t.name}">#tag</a>

      <!-- 태그 삭제 -->
    <form th:if="${isOwner}"
          th:action="@{|/posts/${post.id}/tags/${t.id}/delete|}"
          method="post" style="display:inline">
      <input th:if="${_csrf != null}" type="hidden"
             th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
      <button type="submit"
              style="border:none;background:none;cursor:pointer;">×</button>
    </form>
  </span>
</span>

<!-- 글 수정/삭제 -->
<div th:if="${isOwner}" style="margin:10px 0;">
    <hr>
    <a th:href="@{|/posts/${post.id}/edit|}" style="margin-right:8px;">수정</a>

    <form th:action="@{|/posts/${post.id}/delete|}" method="post" style="display:inline"
        <input th:if="${_csrf != null}" type="hidden"
               th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit">삭제</button>
    </form>
</div>

<!-- 좋아요 기능 -->
<hr>
<form th:action="@{|/posts/${post.id}/like|}" method="post">
    <input th:if="${_csrf != null}"
           type="hidden"
           th:name="${_csrf.parameterName}"
           th:value="${_csrf.token}"/>
    <button type="submit" th:text="${liked} ? '좋아요 해제' : '좋아요'">좋아요</button>
</form>
<p>좋아요 수: <span th:text="${likeCount}">0</span></p>

<hr>
<h2>댓글</h2>
<!-- 댓글 목록 -->
<table>
    <tr th:each="c : ${comments}">
        <td th:text="${c.user.nickname}">닉네임</td>
        <td th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</td>
        <td th:text="${c.content}">내용</td>
        <td>
            <a th:if="${c.user != null and c.user.id == memberId}"
               th:href="@{|/comments/${c.id}/edit|}">수정</a>
        </td>
        <td>
            <form th:if="${c.user != null and c.user.id == memberId}"
                  th:action="@{|/comments/${c.id}/delete|}" method="post">
                <input th:if="${_csrf != null}" type="hidden"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit">삭제</button>
            </form>
        </td>
    </tr>
</table>

<!-- 댓글 작성 폼 -->
<form th:action="@{|/posts/${post.id}/comments|}" method="post">
    <input th:if="${_csrf != null}" type="hidden"
           th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    <textarea name="content" rows="1" cols="30" required></textarea>
    <button type="submit">등록</button>
</form>

<p><a th:href="@{/posts}">목록으로 돌아가기</a></p>
</body>
</html>
